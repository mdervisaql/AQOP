import{j as e}from"./query-vendor-CG4xf7JE.js";import{r as o}from"./react-vendor-Ch0kAUMy.js";import{N as y}from"./Navigation-B2sBVjrF.js";import{b as g}from"./index-DcCoICHm.js";function c(){return"serviceWorker"in navigator&&"PushManager"in window}async function w(){if(!c())throw new Error("Push notifications are not supported");return await Notification.requestPermission()}async function v(){if(!c())return null;const s=await navigator.serviceWorker.ready,{data:{key:t}}=await g.get("/notifications/push/vapid-key");if(!t)throw new Error("VAPID key not found");const r=S(t),i=await s.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:r});return await g.post("/notifications/push/subscribe",i),i}async function N(){if(!c())return;const t=await(await navigator.serviceWorker.ready).pushManager.getSubscription();t&&await t.unsubscribe()}async function j(){return c()?await(await navigator.serviceWorker.ready).pushManager.getSubscription():null}function S(s){const t="=".repeat((4-s.length%4)%4),r=(s+t).replace(/\-/g,"+").replace(/_/g,"/"),i=window.atob(r),l=new Uint8Array(i.length);for(let n=0;n<i.length;++n)l[n]=i.charCodeAt(n);return l}function P(){const[s,t]=o.useState(!1),[r,i]=o.useState("default"),[l,n]=o.useState(!1),[u,d]=o.useState(!1),[p,f]=o.useState(null);o.useEffect(()=>{(async()=>{const m=c();if(t(m),m){i(Notification.permission);const x=await j();n(!!x)}})()},[]);const b=async()=>{d(!0),f(null);try{const a=await w();i(a),a==="granted"?(await v(),n(!0)):f("Permission denied")}catch(a){console.error(a),f("Failed to enable push notifications")}finally{d(!1)}},h=async()=>{d(!0);try{await N(),n(!1)}catch(a){console.error(a),f("Failed to disable push notifications")}finally{d(!1)}};return s?e.jsxs("div",{className:"p-6 bg-white shadow rounded-lg",children:[e.jsx("h3",{className:"text-lg font-medium leading-6 text-gray-900 mb-4",children:"Browser Push Notifications"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Receive notifications even when the application is closed."}),p&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:p})]}),e.jsx("div",{children:l?e.jsx("button",{onClick:h,disabled:u,className:"inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:u?"Processing...":"Disable"}):e.jsx("button",{onClick:b,disabled:u||r==="denied",className:`inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white ${r==="denied"?"bg-gray-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700"} focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500`,children:u?"Processing...":r==="denied"?"Blocked":"Enable"})})]}),r==="denied"&&e.jsx("p",{className:"mt-2 text-sm text-red-600",children:"Notifications are blocked by your browser settings. Please enable them manually in your browser address bar."})]}):e.jsx("div",{className:"p-4 bg-gray-50 rounded-md",children:e.jsx("p",{className:"text-gray-500",children:"Push notifications are not supported in this browser."})})}function D(){return e.jsxs("div",{className:"flex h-screen bg-gray-50",children:[e.jsx(y,{currentPage:"settings"}),e.jsx("main",{className:"flex-1 overflow-y-auto",children:e.jsx("div",{className:"max-w-7xl mx-auto py-6 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"px-4 py-6 sm:px-0",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-6",children:"Notification Settings"}),e.jsx("div",{className:"space-y-6",children:e.jsx(P,{})})]})})})]})}export{D as default};
