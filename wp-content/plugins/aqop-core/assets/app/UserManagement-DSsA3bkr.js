import{j as e}from"./query-vendor-CG4xf7JE.js";import{r as a}from"./react-vendor-Ch0kAUMy.js";import{u as W,L as H,g as J}from"./index-DcCoICHm.js";import{a as I,c as K,u as V,d as X}from"./users-COxa5-Qp.js";import{h as Y}from"./leads-CQ_k3CbU.js";import{f as Z}from"./helpers-Os691a1s.js";import{N as ee}from"./Navigation-B2sBVjrF.js";function de(){const{user:N}=W(),[M,v]=a.useState([]),[x,w]=a.useState(!0),[p,_]=a.useState(null),[A,L]=a.useState([]),[E,D]=a.useState(!0),[c,q]=a.useState(""),[d,R]=a.useState(""),[z,h]=a.useState(!1),[i,C]=a.useState("create"),[P,g]=a.useState(null),[t,n]=a.useState({username:"",email:"",password:"",display_name:"",role:"aq_agent",country_id:""}),[r,m]=a.useState({}),[f,k]=a.useState(!1),[o,y]=a.useState(null),[b,U]=a.useState(!1),S=[{value:"aq_agent",label:"AQ Agent"},{value:"aq_supervisor",label:"AQ Supervisor"},{value:"aq_country_manager",label:"Country Manager"},{value:"operation_manager",label:"Operation Manager"},{value:"operation_admin",label:"Operation Admin"}];a.useEffect(()=>{j(),$()},[d]);const $=async()=>{try{const s=await Y();s.success&&L(s.data)}catch(s){console.error("Error fetching countries:",s)}finally{D(!1)}},j=async()=>{w(!0),_(null);try{const s={};d&&(s.role=d);const l=await I(s);l.success&&l.data?v(l.data):v([])}catch(s){console.error("Error fetching users:",s),_(s.message||"Failed to load users")}finally{w(!1)}},u=M.filter(s=>{if(!c)return!0;const l=c.toLowerCase();return s.username?.toLowerCase().includes(l)||s.email?.toLowerCase().includes(l)||s.display_name?.toLowerCase().includes(l)}),O=()=>{C("create"),g(null),n({username:"",email:"",password:"",display_name:"",role:"aq_agent",country_id:""}),m({}),h(!0)},B=s=>{C("edit"),g(s),n({username:s.username,email:s.email,password:"",display_name:s.display_name||"",role:s.role||"aq_agent",country_id:s.country_id||""}),m({}),h(!0)},F=()=>{h(!1),g(null),n({username:"",email:"",password:"",display_name:"",role:"aq_agent",country_id:""}),m({})},G=()=>{const s={};return i==="create"&&(t.username.trim()?t.username.length<3&&(s.username="Username must be at least 3 characters"):s.username="Username is required",t.password?t.password.length<6&&(s.password="Password must be at least 6 characters"):s.password="Password is required"),t.email.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t.email)||(s.email="Please enter a valid email"):s.email="Email is required",t.display_name.trim()||(s.display_name="Display name is required"),m(s),Object.keys(s).length===0},Q=async s=>{if(s.preventDefault(),!!G()){k(!0);try{i==="create"?(await K(t),alert("User created successfully!")):(await V(P.id,t),alert("User updated successfully!")),F(),await j()}catch(l){console.error("Error saving user:",l),alert(l.message||"Failed to save user")}finally{k(!1)}}},T=async()=>{if(o){U(!0);try{await X(o.id),alert("User deleted successfully!"),y(null),await j()}catch(s){console.error("Error deleting user:",s),alert(s.message||"Failed to delete user")}finally{U(!1)}}};return e.jsxs("div",{className:"flex h-screen bg-gray-50",children:[e.jsx(ee,{currentPage:"users"}),e.jsx("main",{className:"flex-1 overflow-y-auto",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"User Management"}),e.jsx("p",{className:"mt-2 text-gray-600",children:"Manage AQOP platform users and roles"})]}),e.jsxs("button",{onClick:O,className:"inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("svg",{className:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Add New User"]})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow p-6 mb-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{htmlFor:"search",className:"block text-sm font-medium text-gray-700 mb-1",children:"Search Users"}),e.jsx("input",{type:"text",id:"search",value:c,onChange:s=>q(s.target.value),placeholder:"Search by username, email, or name...",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"roleFilter",className:"block text-sm font-medium text-gray-700 mb-1",children:"Filter by Role"}),e.jsxs("select",{id:"roleFilter",value:d,onChange:s=>R(s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"All Roles"}),S.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))]})]})]})}),x&&e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(H,{size:"lg",text:"Loading users..."})}),p&&!x&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-6",children:e.jsx("p",{className:"text-red-800",children:p})}),!x&&!p&&e.jsxs("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:e.jsxs("h3",{className:"text-lg font-medium text-gray-900",children:[u.length," User",u.length!==1?"s":""]})}),u.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("svg",{className:"mx-auto h-12 w-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"})}),e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No users found"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:c||d?"Try adjusting your filters":"Get started by creating a new user"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"User"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Email"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Role"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Created"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Country"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:u.map(s=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 h-10 w-10 rounded-full bg-blue-100 flex items-center justify-center",children:e.jsx("span",{className:"text-blue-600 font-medium text-sm",children:s.display_name?.charAt(0)||s.username?.charAt(0)||"U"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:s.display_name||s.username}),e.jsxs("div",{className:"text-sm text-gray-500",children:["@",s.username]})]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-900",children:s.email})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-blue-800",children:J(s.role)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:s.registered?Z(s.registered):"N/A"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:s.country_name?e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:s.country_name}):e.jsx("span",{className:"text-gray-400 italic",children:"Global"})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:[e.jsx("button",{onClick:()=>B(s),className:"text-blue-600 hover:text-blue-900 mr-4",children:"Edit"}),e.jsx("button",{onClick:()=>y(s),disabled:s.id===N?.id,className:"text-red-600 hover:text-red-900 disabled:opacity-50 disabled:cursor-not-allowed",title:s.id===N?.id?"Can't delete yourself":"Delete user",children:"Delete"})]})]},s.id))})]})})]}),z&&e.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl p-8 max-w-md w-full max-h-screen overflow-y-auto",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-6",children:i==="create"?"Add New User":"Edit User"}),e.jsxs("form",{onSubmit:Q,className:"space-y-4",children:[i==="create"&&e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"username",className:"block text-sm font-medium text-gray-700 mb-1",children:["Username ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",id:"username",value:t.username,onChange:s=>n({...t,username:s.target.value}),className:`w-full px-3 py-2 border ${r.username?"border-red-300":"border-gray-300"} rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500`,placeholder:"username"}),r.username&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:r.username})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-1",children:["Email ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"email",id:"email",value:t.email,onChange:s=>n({...t,email:s.target.value}),className:`w-full px-3 py-2 border ${r.email?"border-red-300":"border-gray-300"} rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500`,placeholder:"user@example.com"}),r.email&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:r.email})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 mb-1",children:["Password ",i==="create"&&e.jsx("span",{className:"text-red-500",children:"*"}),i==="edit"&&e.jsx("span",{className:"text-gray-500 font-normal",children:"(leave blank to keep current)"})]}),e.jsx("input",{type:"password",id:"password",value:t.password,onChange:s=>n({...t,password:s.target.value}),className:`w-full px-3 py-2 border ${r.password?"border-red-300":"border-gray-300"} rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500`,placeholder:"••••••••"}),r.password&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:r.password})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"display_name",className:"block text-sm font-medium text-gray-700 mb-1",children:["Display Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",id:"display_name",value:t.display_name,onChange:s=>n({...t,display_name:s.target.value}),className:`w-full px-3 py-2 border ${r.display_name?"border-red-300":"border-gray-300"} rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500`,placeholder:"John Doe"}),r.display_name&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:r.display_name})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"role",className:"block text-sm font-medium text-gray-700 mb-1",children:["Role ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("select",{id:"role",value:t.role,onChange:s=>n({...t,role:s.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:S.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"country_id",className:"block text-sm font-medium text-gray-700 mb-1",children:"Assigned Country"}),e.jsxs("select",{id:"country_id",value:t.country_id,onChange:s=>n({...t,country_id:s.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:E,children:[e.jsx("option",{value:"",children:"None (Global Access)"}),A.map(s=>e.jsx("option",{value:s.id,children:s.country_name_en},s.id))]}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Assigning a country restricts access for Country Managers."})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:F,className:"px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50",disabled:f,children:"Cancel"}),e.jsx("button",{type:"submit",disabled:f,className:"px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 disabled:opacity-50",children:f?"Saving...":i==="create"?"Create User":"Update User"})]})]})]})}),o&&e.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl p-8 max-w-md w-full",children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 mx-auto mb-4 bg-red-100 rounded-full",children:e.jsx("svg",{className:"w-6 h-6 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 text-center mb-2",children:"Delete User"}),e.jsxs("p",{className:"text-sm text-gray-500 text-center mb-6",children:["Are you sure you want to delete ",e.jsx("strong",{children:o.display_name||o.username}),"? This action cannot be undone."]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{onClick:()=>y(null),className:"px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50",disabled:b,children:"Cancel"}),e.jsx("button",{onClick:T,disabled:b,className:"px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-red-600 hover:bg-red-700 disabled:opacity-50",children:b?"Deleting...":"Delete User"})]})]})})]})})]})}export{de as default};
