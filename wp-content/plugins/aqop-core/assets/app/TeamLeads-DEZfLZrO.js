import{j as e}from"./query-vendor-CG4xf7JE.js";import{r as n}from"./react-vendor-Ch0kAUMy.js";import{u as F,L as P}from"./index-DcCoICHm.js";import{i as H,j as M}from"./leads-CQ_k3CbU.js";import{g as T}from"./users-COxa5-Qp.js";import{N as E}from"./Navigation-B2sBVjrF.js";import{L as W}from"./LeadCard-Cq47qKLX.js";import"./helpers-Os691a1s.js";function $(){const{user:k}=F(),[i,g]=n.useState([]),[C,S]=n.useState([]),[d,p]=n.useState(!0),[u,f]=n.useState(null),[t,j]=n.useState({status:"",priority:"",search:"",assigned_to:""}),[r,c]=n.useState([]),[o,b]=n.useState(""),[m,v]=n.useState(""),[y,N]=n.useState(!1);n.useEffect(()=>{h()},[t]);const h=async()=>{p(!0),f(null);try{const s={};t.status&&(s.status=t.status),t.priority&&(s.priority=t.priority),t.search&&(s.search=t.search),t.assigned_to&&(s.assigned_to=t.assigned_to);const a=await H(s);a.success&&a.data?g(a.data.results||[]):g([]);const l=await T();S(l||[])}catch(s){console.error("Error fetching data:",s),f(s.message||"Failed to load team leads")}finally{p(!1)}},x=(s,a)=>{j(l=>({...l,[s]:a}))},w=()=>{j({status:"",priority:"",search:"",assigned_to:""})},L=s=>{c(a=>a.includes(s)?a.filter(l=>l!==s):[...a,s])},A=()=>{r.length===i.length?c([]):c(i.map(s=>s.id))},_=async()=>{if(!(!o||r.length===0)){N(!0);try{const s=[];for(const a of r){const l={};if(o==="assign"&&m)l.assigned_to=parseInt(m);else if(o.startsWith("status_")){const B=o.replace("status_","");l.status_code=B}Object.keys(l).length>0&&s.push(M(a,l))}await Promise.all(s),await h(),c([]),b(""),v(""),alert(`Successfully updated ${r.length} lead(s)!`)}catch(s){console.error("Bulk action error:",s),alert("Some updates may have failed. Please check and try again.")}finally{N(!1)}}};return e.jsxs("div",{className:"flex h-screen bg-gray-50",children:[e.jsx(E,{currentPage:"team-leads"}),e.jsx("main",{className:"flex-1 overflow-y-auto",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Team Leads"}),e.jsxs("p",{className:"mt-2 text-gray-600",children:["Manage and assign team leads - ",k?.display_name]})]}),e.jsx("div",{className:"bg-white rounded-lg shadow p-6 mb-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{htmlFor:"search",className:"block text-sm font-medium text-gray-700 mb-1",children:"Search"}),e.jsx("input",{type:"text",id:"search",value:t.search,onChange:s=>x("search",s.target.value),placeholder:"Search leads...",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"status",className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),e.jsxs("select",{id:"status",value:t.status,onChange:s=>x("status",s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"All Statuses"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"contacted",children:"Contacted"}),e.jsx("option",{value:"qualified",children:"Qualified"}),e.jsx("option",{value:"converted",children:"Converted"}),e.jsx("option",{value:"lost",children:"Lost"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"priority",className:"block text-sm font-medium text-gray-700 mb-1",children:"Priority"}),e.jsxs("select",{id:"priority",value:t.priority,onChange:s=>x("priority",s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"All Priorities"}),e.jsx("option",{value:"low",children:"Low"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"high",children:"High"}),e.jsx("option",{value:"urgent",children:"Urgent"})]})]}),e.jsx("div",{className:"flex items-end",children:e.jsx("button",{onClick:w,className:"w-full px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500",children:"Clear Filters"})})]})}),r.length>0&&e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:"text-sm font-medium text-blue-900",children:[r.length," lead",r.length!==1?"s":""," selected"]}),e.jsxs("select",{value:o,onChange:s=>b(s.target.value),className:"px-3 py-1 border border-blue-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Select Action"}),e.jsx("option",{value:"assign",children:"Assign To..."}),e.jsx("option",{value:"status_pending",children:"Change Status → Pending"}),e.jsx("option",{value:"status_contacted",children:"Change Status → Contacted"}),e.jsx("option",{value:"status_qualified",children:"Change Status → Qualified"}),e.jsx("option",{value:"status_converted",children:"Change Status → Converted"}),e.jsx("option",{value:"status_lost",children:"Change Status → Lost"})]}),o==="assign"&&e.jsxs("select",{value:m,onChange:s=>v(s.target.value),className:"px-3 py-1 border border-blue-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Select Agent"}),C.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]}),e.jsx("button",{onClick:_,disabled:y||!o||o==="assign"&&!m,className:"px-4 py-1 bg-blue-600 text-white rounded-md text-sm font-medium hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50",children:y?"Processing...":"Apply"})]}),e.jsx("button",{onClick:()=>c([]),className:"text-sm text-blue-600 hover:text-blue-800",children:"Clear Selection"})]})}),d&&e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(P,{size:"lg",text:"Loading team leads..."})}),u&&!d&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("svg",{className:"w-5 h-5 text-red-600 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("p",{className:"text-red-800",children:u})]})}),!d&&!u&&i.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx("svg",{className:"mx-auto h-12 w-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"})}),e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No leads found"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:Object.values(t).some(s=>s)?"Try adjusting your filters":"No team leads available"})]}),!d&&!u&&i.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("input",{type:"checkbox",checked:r.length===i.length,onChange:A,className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Showing ",e.jsx("span",{className:"font-medium",children:i.length})," lead",i.length!==1?"s":""]})]}),e.jsxs("button",{onClick:h,className:"text-sm text-blue-600 hover:text-blue-800 flex items-center",children:[e.jsx("svg",{className:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),"Refresh"]})]}),e.jsx("div",{className:"space-y-4",children:i.map(s=>e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("input",{type:"checkbox",checked:r.includes(s.id),onChange:()=>L(s.id),className:"mt-6 h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e.jsx("div",{className:"flex-1",children:e.jsx(W,{lead:s,showAssignee:!0})})]},s.id))})]})]})})]})}export{$ as default};
