import{j as e}from"./query-vendor-CG4xf7JE.js";import{a as v,L as j,u as b,h as u,R as m}from"./index-DcCoICHm.js";import{u as y,a as w}from"./useLeads-BthcpCpB.js";import{N as L}from"./Navigation-B2sBVjrF.js";import{L as k}from"./LeadCard-Cq47qKLX.js";import{r as c,L as g,f as C}from"./react-vendor-Ch0kAUMy.js";import{f as M,a as A}from"./ar-C-aLhSM3.js";import{g as R,c as _}from"./communications-XQojI1Lv.js";import{f as E}from"./helpers-Os691a1s.js";import"./leads-CQ_k3CbU.js";function O(){const{unreadCount:a,notifications:r,fetchNotifications:x,markAsRead:l,markAllAsRead:d}=v(),[n,i]=c.useState(!1),o=c.useRef(null);c.useEffect(()=>{n&&x(1)},[n,x]),c.useEffect(()=>{function t(h){o.current&&!o.current.contains(h.target)&&i(!1)}return document.addEventListener("mousedown",t),()=>document.removeEventListener("mousedown",t)},[o]);const s=t=>{t.is_read||l(t.id),i(!1)};return e.jsxs("div",{className:"relative",ref:o,children:[e.jsxs("button",{onClick:()=>i(!n),className:"relative p-2 text-gray-600 hover:text-gray-900 focus:outline-none",children:[e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"})}),a>0&&e.jsx("span",{className:"absolute top-0 right-0 inline-flex items-center justify-center px-2 py-1 text-xs font-bold leading-none text-white transform translate-x-1/4 -translate-y-1/4 bg-red-600 rounded-full",children:a>99?"99+":a})]}),n&&e.jsx("div",{className:"absolute left-0 z-50 w-80 mt-2 origin-top-right bg-white rounded-md shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none rtl:left-0 rtl:right-auto ltr:right-0 ltr:left-auto",children:e.jsxs("div",{className:"py-1",children:[e.jsxs("div",{className:"px-4 py-2 border-b border-gray-100 flex justify-between items-center",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-900",children:"Notifications"}),a>0&&e.jsx("button",{onClick:d,className:"text-xs text-blue-600 hover:text-blue-800",children:"Mark all read"})]}),e.jsx("div",{className:"max-h-96 overflow-y-auto",children:r.length>0?r.slice(0,5).map(t=>e.jsx("div",{className:`px-4 py-3 hover:bg-gray-50 border-b border-gray-50 last:border-0 ${t.is_read?"":"bg-blue-50"}`,children:e.jsxs(g,{to:t.action_url||"#",onClick:()=>s(t),className:"block",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:t.title}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:t.message}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:M(new Date(t.created_at),{addSuffix:!0,locale:A})})]})},t.id)):e.jsx("div",{className:"px-4 py-6 text-center text-gray-500 text-sm",children:"No notifications"})}),e.jsx("div",{className:"px-4 py-2 border-t border-gray-100 bg-gray-50 text-center",children:e.jsx(g,{to:"/notifications",onClick:()=>i(!1),className:"text-sm text-blue-600 hover:text-blue-800 font-medium",children:"View All Notifications"})})]})})]})}function S(){const[a,r]=c.useState([]),[x,l]=c.useState(!0),[d,n]=c.useState(null),i=async()=>{l(!0);try{const s=await R();r(s||[])}catch(s){console.error("Error loading follow-ups:",s)}finally{l(!1)}};c.useEffect(()=>{i()},[]);const o=async s=>{n(s);try{await _(s),r(t=>t.filter(h=>h.id!==s))}catch(t){console.error("Error completing follow-up:",t)}finally{n(null)}};return x?e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6 h-full flex items-center justify-center",children:e.jsx(j,{size:"sm"})}):e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6 h-full",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-900 flex items-center gap-2",children:[e.jsx("span",{className:"text-xl",children:"ðŸ“…"})," Today's Follow-ups"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(g,{to:"/follow-ups",className:"text-xs text-blue-600 hover:text-blue-800 font-medium",children:"View All"}),e.jsx("span",{className:"bg-blue-100 text-blue-800 text-xs font-medium px-2.5 py-0.5 rounded-full",children:a.length})]})]}),a.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx("p",{children:"No follow-ups scheduled for today."}),e.jsx("p",{className:"text-sm mt-1",children:"Great job! ðŸŽ‰"})]}):e.jsx("div",{className:"space-y-3 max-h-80 overflow-y-auto pr-2 custom-scrollbar",children:a.map(s=>e.jsxs("div",{className:"flex items-start justify-between p-3 bg-gray-50 rounded-lg border border-gray-100 hover:border-blue-200 transition-colors",children:[e.jsxs("div",{className:"min-w-0 flex-1 mr-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"text-xs font-medium text-gray-500",children:E(s.due_date).split(",")[1]}),e.jsx(g,{to:`/leads/${s.lead_id}`,className:"text-sm font-medium text-blue-600 hover:text-blue-800 truncate",children:s.lead_name})]}),e.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:s.title}),s.description&&e.jsx("p",{className:"text-xs text-gray-500 mt-0.5 line-clamp-1",children:s.description})]}),e.jsx("button",{onClick:()=>o(s.id),disabled:d===s.id,className:"flex-shrink-0 p-1.5 text-gray-400 hover:text-green-600 hover:bg-green-50 rounded-full transition-colors",title:"Mark as Complete",children:d===s.id?e.jsx("div",{className:"w-5 h-5 border-2 border-gray-300 border-t-green-600 rounded-full animate-spin"}):e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})})]},s.id))})]})}function H(){const{user:a}=b(),r=C(),x=u(a,[m.AGENT]),l=u(a,[m.SUPERVISOR]),d=u(a,[m.ADMIN,m.OPERATION_ADMIN,m.OPERATION_MANAGER]);u(a,[m.ADMIN,m.OPERATION_ADMIN]);const n=d||l,{data:i,isLoading:o}=y({refetchInterval:3e4}),s=i?.data,{data:t,isLoading:h}=w({per_page:5,orderby:"created_at",order:"DESC",limit:5},!d&&!l,{refetchInterval:6e4}),f=t?.data?.results||[],N=o||h;return e.jsxs("div",{className:"flex h-screen bg-gray-50",children:[e.jsx(L,{currentPage:"dashboard"}),e.jsx("main",{className:"flex-1 overflow-y-auto",children:e.jsx("div",{className:"max-w-7xl mx-auto py-6 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"px-4 py-6 sm:px-0",children:[e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6 mb-8",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:["Welcome back, ",a?.display_name||a?.username,"!"]}),e.jsxs("p",{className:"text-gray-600",children:["Role: ",e.jsx("strong",{className:"text-indigo-600 font-medium",children:a?.role?.replace("_"," ")})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(O,{}),e.jsxs("div",{className:"flex items-center bg-emerald-50 px-4 py-2 rounded-full border border-emerald-100",children:[e.jsxs("span",{className:"relative flex h-3 w-3 mr-2",children:[e.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-emerald-400 opacity-75"}),e.jsx("span",{className:"relative inline-flex rounded-full h-3 w-3 bg-emerald-500"})]}),e.jsx("span",{className:"text-sm font-medium text-emerald-700",children:"Live Updates Active"})]})]})]})}),N?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(j,{size:"lg",text:"Loading dashboard..."})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-4 mb-8",children:[e.jsx("div",{className:"bg-white overflow-hidden shadow-sm rounded-xl border border-gray-100 transition-all hover:shadow-md",children:e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 p-3 bg-indigo-50 rounded-lg",children:e.jsx("svg",{className:"h-6 w-6 text-indigo-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"})})}),e.jsx("div",{className:"ml-5 w-0 flex-1",children:e.jsxs("dl",{children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500 truncate",children:x?"My Leads":"Total Leads"}),e.jsx("dd",{className:"text-2xl font-bold text-gray-900 mt-1",children:s?.total_leads||0})]})})]})})}),e.jsx("div",{className:"bg-white overflow-hidden shadow-sm rounded-xl border border-gray-100 transition-all hover:shadow-md",children:e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 p-3 bg-amber-50 rounded-lg",children:e.jsx("svg",{className:"h-6 w-6 text-amber-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsx("div",{className:"ml-5 w-0 flex-1",children:e.jsxs("dl",{children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500 truncate",children:"Pending"}),e.jsx("dd",{className:"text-2xl font-bold text-gray-900 mt-1",children:s?.pending_leads||0})]})})]})})}),e.jsx("div",{className:"bg-white overflow-hidden shadow-sm rounded-xl border border-gray-100 transition-all hover:shadow-md",children:e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 p-3 bg-blue-50 rounded-lg",children:e.jsx("svg",{className:"h-6 w-6 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})})}),e.jsx("div",{className:"ml-5 w-0 flex-1",children:e.jsxs("dl",{children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500 truncate",children:"Contacted"}),e.jsx("dd",{className:"text-2xl font-bold text-gray-900 mt-1",children:s?.contacted_leads||0})]})})]})})}),e.jsx("div",{className:"bg-white overflow-hidden shadow-sm rounded-xl border border-gray-100 transition-all hover:shadow-md",children:e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 p-3 bg-emerald-50 rounded-lg",children:e.jsx("svg",{className:"h-6 w-6 text-emerald-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsx("div",{className:"ml-5 w-0 flex-1",children:e.jsxs("dl",{children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500 truncate",children:"Converted"}),e.jsx("dd",{className:"text-2xl font-bold text-gray-900 mt-1",children:s?.converted_leads||0})]})})]})})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-2 bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:d?"Recent Leads":l?"Team Recent Leads":"My Recent Leads"}),e.jsxs("button",{onClick:()=>{r(d?"/manager/all-leads":l?"/supervisor/team-leads":"/leads")},className:"text-sm text-indigo-600 hover:text-indigo-800 font-medium flex items-center gap-1",children:["View All ",e.jsx("span",{"aria-hidden":"true",children:"â†’"})]})]}),f.length===0?e.jsxs("div",{className:"text-center py-12 bg-gray-50 rounded-lg border border-dashed border-gray-200",children:[e.jsx("div",{className:"bg-white p-3 rounded-full inline-flex mb-4 shadow-sm",children:e.jsx("svg",{className:"h-8 w-8 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"})})}),e.jsx("p",{className:"text-base font-medium text-gray-900",children:"No leads assigned yet"}),x&&e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Contact your manager to get leads assigned"})]}):e.jsx("div",{className:"space-y-4",children:f.map(p=>e.jsx(k,{lead:p,showAssignee:n},p.id))})]}),e.jsx("div",{className:"lg:col-span-1",children:e.jsx(S,{})})]})]})]})})})]})}export{H as default};
