import{j as e}from"./query-vendor-CG4xf7JE.js";import{r as c,u as Q,f as W}from"./react-vendor-Ch0kAUMy.js";import{c as j,b as l}from"./index-DcCoICHm.js";import{N as q,F as O}from"./Navigation-B2sBVjrF.js";import{T as X,C as y}from"./triangle-alert-oPdxbqhj.js";const Y=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],Z=j("arrow-right",Y);const ee=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],z=j("loader-circle",ee);const se=[["path",{d:"m18.84 12.25 1.72-1.71h-.02a5.004 5.004 0 0 0-.12-7.07 5.006 5.006 0 0 0-6.95 0l-1.72 1.71",key:"yqzxt4"}],["path",{d:"m5.17 11.75-1.71 1.71a5.004 5.004 0 0 0 .12 7.07 5.006 5.006 0 0 0 6.95 0l1.71-1.71",key:"4qinb0"}],["line",{x1:"8",x2:"8",y1:"2",y2:"5",key:"1041cp"}],["line",{x1:"2",x2:"5",y1:"8",y2:"8",key:"14m1p5"}],["line",{x1:"16",x2:"16",y1:"19",y2:"22",key:"rzdirn"}],["line",{x1:"19",x2:"22",y1:"16",y2:"16",key:"ox905f"}]],ae=j("unlink",se),i={getOAuthUrl:r=>l.get("/facebook/oauth-url",{params:{redirect_uri:r}}),handleOAuthCallback:(r,o)=>l.post("/facebook/oauth-callback",{code:r,redirect_uri:o}),getConnection:()=>l.get("/facebook/connection"),disconnect:()=>l.post("/facebook/disconnect"),getAdAccounts:()=>l.get("/facebook/ad-accounts"),getPages:()=>l.get("/facebook/pages"),getForms:(r,o)=>l.get("/facebook/forms",{params:{page_id:r,page_access_token:o}}),getFormFields:(r,o)=>l.get(`/facebook/forms/${r}/fields`,{params:{access_token:o}}),saveMapping:(r,o)=>l.post(`/facebook/forms/${r}/map`,o)},le=()=>{const[r,o]=c.useState(!0),[u,v]=c.useState(null),[p,N]=c.useState([]),[m,k]=c.useState(null),[w,g]=c.useState([]),[x,h]=c.useState(null),[f,D]=c.useState([]),[F,S]=c.useState({}),[_,C]=c.useState(!1),[A,d]=c.useState(null),[P,b]=c.useState(null),M=Q(),I=W(),L=window.location.origin+"/settings/facebook-leads";c.useEffect(()=>{E()},[]),c.useEffect(()=>{const a=new URLSearchParams(M.search).get("code");a&&U(a)},[M]);const E=async()=>{try{o(!0);const s=await i.getConnection();v(s.data),s.data.connected&&T()}catch(s){console.error(s),d("Failed to fetch connection status.")}finally{o(!1)}},U=async s=>{try{o(!0),await i.handleOAuthCallback(s,L),b("Successfully connected to Facebook!"),I("/settings/facebook-leads",{replace:!0}),E()}catch(a){console.error(a),d("Failed to connect to Facebook. Please try again.")}finally{o(!1)}},$=async()=>{try{const s=await i.getOAuthUrl(L);window.location.href=s.data.url}catch(s){console.error(s),d("Failed to initialize connection.")}},R=async()=>{if(window.confirm("Are you sure you want to disconnect? Lead syncing will stop."))try{await i.disconnect(),v({connected:!1}),N([]),g([]),k(null),h(null),b("Disconnected successfully.")}catch(s){console.error(s),d("Failed to disconnect.")}},T=async()=>{try{const s=await i.getPages();N(s.data)}catch(s){console.error(s),d("Failed to fetch pages.")}},B=async s=>{const a=s.target.value,n=p.find(t=>t.id===a);if(k(n),h(null),g([]),n)try{const t=await i.getForms(n.id,n.access_token);g(t.data)}catch(t){console.error(t),d("Failed to fetch forms.")}},V=async s=>{const a=s.target.value,n=w.find(t=>t.id===a);if(h(n),n)try{const t=await i.getFormFields(n.id,m.access_token);D(t.data),S({})}catch(t){console.error(t),d("Failed to fetch form fields.")}},G=(s,a,n)=>{S(t=>({...t,[s]:{type:a,value:n}}))},H=async()=>{if(!(!x||!m))try{C(!0);const s=Object.entries(F).map(([n,t])=>({fb_field:n,fb_label:f.find(K=>K.name===n)?.label||n,[t.type==="core"?"wp_field":"question_id"]:t.value}));await i.saveMapping(x.id,{form_name:x.name,page_id:m.id,campaign_group_id:null,mappings:s}),b("Mapping saved successfully!");const a=await i.getForms(m.id,m.access_token);g(a.data)}catch(s){console.error(s),d("Failed to save mapping.")}finally{C(!1)}},J=[{value:"name",label:"Name"},{value:"email",label:"Email"},{value:"phone",label:"Phone"},{value:"notes",label:"Notes"}];return r&&!u?e.jsxs("div",{className:"flex h-screen bg-gray-50",children:[e.jsx(q,{currentPage:"facebook-leads"}),e.jsx("main",{className:"flex-1 overflow-y-auto",children:e.jsx("div",{className:"flex justify-center items-center h-full",children:e.jsx(z,{className:"animate-spin text-4xl text-blue-600"})})})]}):e.jsxs("div",{className:"flex h-screen bg-gray-50",children:[e.jsx(q,{currentPage:"facebook-leads"}),e.jsx("main",{className:"flex-1 overflow-y-auto",children:e.jsx("div",{className:"max-w-7xl mx-auto py-6 sm:px-6 lg:px-8",children:e.jsx("div",{className:"px-4 py-6 sm:px-0",children:e.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(O,{className:"text-4xl text-blue-600"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800",children:"Facebook Lead Ads"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Sync leads from your Facebook Lead Forms"})]})]}),e.jsx("div",{children:u?.connected?e.jsxs("button",{onClick:R,className:"flex items-center gap-2 px-4 py-2 border border-red-200 text-red-600 rounded hover:bg-red-50 transition",children:[e.jsx(ae,{})," Disconnect"]}):e.jsxs("button",{onClick:$,className:"flex items-center gap-2 px-6 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition font-medium",children:[e.jsx(O,{})," Connect with Facebook"]})})]}),A&&e.jsxs("div",{className:"mb-4 p-4 bg-red-50 text-red-700 rounded flex items-center gap-2",children:[e.jsx(X,{})," ",A]}),P&&e.jsxs("div",{className:"mb-4 p-4 bg-green-50 text-green-700 rounded flex items-center gap-2",children:[e.jsx(y,{})," ",P]}),u?.connected&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 bg-gray-50 p-4 rounded border border-gray-100",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wider",children:"Connected As"}),e.jsx("p",{className:"font-medium text-gray-800",children:u.fb_user_name})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wider",children:"Pages Available"}),e.jsx("p",{className:"font-medium text-gray-800",children:p.length})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsxs("p",{className:"flex items-center gap-1 text-green-600 font-medium",children:[e.jsx(y,{})," Active"]})]})]})]}),u?.connected&&e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-800 mb-4",children:"Form Mapping"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Page"}),e.jsxs("select",{className:"w-full p-2 border rounded focus:ring-2 focus:ring-blue-500 outline-none",onChange:B,value:m?.id||"",children:[e.jsx("option",{value:"",children:"-- Select a Page --"}),p.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Lead Form"}),e.jsxs("select",{className:"w-full p-2 border rounded focus:ring-2 focus:ring-blue-500 outline-none",onChange:V,value:x?.id||"",disabled:!m,children:[e.jsx("option",{value:"",children:"-- Select a Form --"}),w.map(s=>e.jsxs("option",{value:s.id,children:[s.name," (",s.status==="ACTIVE"?"Active":s.status,")",s.is_mapped?" âœ… Mapped":""]},s.id))]})]})]}),x&&f.length>0&&e.jsxs("div",{className:"border-t pt-6",children:[e.jsxs("h4",{className:"font-medium text-gray-800 mb-4",children:['Map Fields for "',x.name,'"']}),e.jsx("div",{className:"space-y-4",children:f.map(s=>e.jsxs("div",{className:"flex items-center gap-4 p-3 bg-gray-50 rounded border border-gray-100",children:[e.jsxs("div",{className:"w-1/3",children:[e.jsx("p",{className:"font-medium text-gray-700",children:s.label}),e.jsxs("p",{className:"text-xs text-gray-500 font-mono",children:[s.name," (",s.type,")"]})]}),e.jsx("div",{className:"flex items-center justify-center text-gray-400",children:e.jsx(Z,{})}),e.jsx("div",{className:"w-1/2",children:e.jsxs("select",{className:"w-full p-2 border rounded text-sm",onChange:a=>G(s.name,"core",a.target.value),value:F[s.name]?.value||"",children:[e.jsx("option",{value:"",children:"-- Do Not Import --"}),e.jsx("optgroup",{label:"Core Fields",children:J.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))})]})})]},s.name))}),e.jsx("div",{className:"mt-6 flex justify-end",children:e.jsxs("button",{onClick:H,disabled:_,className:"flex items-center gap-2 px-6 py-2 bg-green-600 text-white rounded hover:bg-green-700 transition disabled:opacity-50",children:[_?e.jsx(z,{className:"animate-spin"}):e.jsx(y,{}),"Save Mapping"]})})]})]})]})})})})]})};export{le as default};
