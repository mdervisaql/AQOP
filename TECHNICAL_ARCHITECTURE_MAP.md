# ğŸ—ºï¸ AQOP Technical Architecture Map

**Document:** Technical Architecture & Data Flow Diagram  
**Version:** 1.0.10 | **Date:** February 7, 2026

---

## Part 1: System Architecture Overview

### High-Level System Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    AQOP OPERATION PLATFORM                       â”‚
â”‚                     (WordPress-Based)                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                            â”‚  WordPress Core  â”‚
                            â”‚    (6.0+)        â”‚
                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                            â”‚                             â”‚
        â–¼                            â–¼                             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Admin â”‚              â”‚  REST API    â”‚              â”‚  Public     â”‚
    â”‚ Pages  â”‚              â”‚  (/wp-json)  â”‚              â”‚  Front-end  â”‚
    â”‚        â”‚              â”‚              â”‚              â”‚  (React)    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                            â”‚                             â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                                 â”‚
                    â–¼                                 â–¼
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚  WordPress Core  â”‚            â”‚  Plugins Layer   â”‚
           â”‚  Functions &     â”‚            â”‚                  â”‚
           â”‚  Database Layer  â”‚            â”‚  â€¢ aqop-core     â”‚
           â”‚                  â”‚            â”‚  â€¢ aqop-leads    â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚  â€¢ aqop-jwt-auth â”‚
                    â”‚                      â”‚  â€¢ aqop-feedback â”‚
                    â”‚                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚                               â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚                            â”‚
                          â–¼                            â–¼
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚  MySQL/InnoDB   â”‚        â”‚  WordPress Cache â”‚
                  â”‚  Database       â”‚        â”‚  (Optional)      â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Part 2: Component Architecture

### aqop-core (Foundation Layer)

```
AQOP_CORE
â”‚
â”œâ”€â”€ AQOP_Core (Main Loader)
â”‚   â”œâ”€â”€ Load dependencies
â”‚   â”œâ”€â”€ Register hooks
â”‚   â””â”€â”€ Initialize system
â”‚
â”œâ”€â”€ AQOP_Installer
â”‚   â”œâ”€â”€ Create database tables
â”‚   â”œâ”€â”€ Pre-load reference data
â”‚   â””â”€â”€ Set default options
â”‚
â”œâ”€â”€ AQOP_Roles_Manager
â”‚   â”œâ”€â”€ Define 4 custom roles
â”‚   â”œâ”€â”€ Assign capabilities
â”‚   â””â”€â”€ Manage permissions
â”‚
â”œâ”€â”€ AQOP_Event_Logger
â”‚   â”œâ”€â”€ Log all system events
â”‚   â”œâ”€â”€ Store in wp_aq_events_log
â”‚   â””â”€â”€ Provide audit trail
â”‚
â”œâ”€â”€ AQOP_Integrations_Hub
â”‚   â”œâ”€â”€ Airtable sync
â”‚   â”œâ”€â”€ Telegram notifications
â”‚   â”œâ”€â”€ Facebook integration
â”‚   â”œâ”€â”€ WhatsApp integration
â”‚   â””â”€â”€ Dropbox storage
â”‚
â”œâ”€â”€ AQOP_Frontend_Guard
â”‚   â”œâ”€â”€ Rate limiting
â”‚   â”œâ”€â”€ IP tracking
â”‚   â””â”€â”€ Security checks
â”‚
â”œâ”€â”€ AQOP_Session_Manager
â”‚   â”œâ”€â”€ Session handling
â”‚   â”œâ”€â”€ User state
â”‚   â””â”€â”€ Activity tracking
â”‚
â””â”€â”€ AQOP_Activity_Tracker
    â”œâ”€â”€ Track user actions
    â”œâ”€â”€ Log navigation
    â””â”€â”€ Monitor engagement
```

### aqop-leads (Feature Layer)

```
AQOP_LEADS
â”‚
â”œâ”€â”€ AQOP_Leads_Core (Bootstrap)
â”‚   â”œâ”€â”€ Load lead dependencies
â”‚   â”œâ”€â”€ Register REST routes
â”‚   â””â”€â”€ Initialize module
â”‚
â”œâ”€â”€ AQOP_Leads_Manager (Business Logic)
â”‚   â”œâ”€â”€ Create lead
â”‚   â”œâ”€â”€ Update lead
â”‚   â”œâ”€â”€ Delete lead
â”‚   â”œâ”€â”€ Assign lead
â”‚   â”œâ”€â”€ Change status
â”‚   â”œâ”€â”€ Add note
â”‚   â”œâ”€â”€ Query leads
â”‚   â”œâ”€â”€ Export to CSV
â”‚   â””â”€â”€ Sync to Airtable
â”‚
â”œâ”€â”€ AQOP_Leads_Admin (Admin Interface)
â”‚   â”œâ”€â”€ Render leads list
â”‚   â”œâ”€â”€ Lead form page
â”‚   â”œâ”€â”€ Lead detail page
â”‚   â”œâ”€â”€ Dashboard page
â”‚   â”œâ”€â”€ Settings page
â”‚   â”œâ”€â”€ Import/Export page
â”‚   â””â”€â”€ Handle AJAX requests
â”‚
â”œâ”€â”€ AQOP_Public_Form (Public Interface)
â”‚   â”œâ”€â”€ Render form shortcode
â”‚   â”œâ”€â”€ Handle submissions
â”‚   â”œâ”€â”€ Rate limiting
â”‚   â””â”€â”€ Send notifications
â”‚
â”œâ”€â”€ AQOP_Leads_API (REST API)
â”‚   â”œâ”€â”€ GET /leads
â”‚   â”œâ”€â”€ POST /leads
â”‚   â”œâ”€â”€ PUT /leads/{id}
â”‚   â”œâ”€â”€ DELETE /leads/{id}
â”‚   â”œâ”€â”€ GET /statuses
â”‚   â”œâ”€â”€ GET /sources
â”‚   â”œâ”€â”€ GET /countries
â”‚   â””â”€â”€ Permission checking
â”‚
â”œâ”€â”€ AQOP_Lead_Details_Handler
â”‚   â”œâ”€â”€ Load lead data
â”‚   â”œâ”€â”€ Load related notes
â”‚   â”œâ”€â”€ Load activity log
â”‚   â””â”€â”€ Prepare for display
â”‚
â”œâ”€â”€ AQOP_Lead_Scoring
â”‚   â”œâ”€â”€ Calculate lead score
â”‚   â”œâ”€â”€ Update scoring
â”‚   â””â”€â”€ Track conversion
â”‚
â”œâ”€â”€ AQOP_Notification_Manager
â”‚   â”œâ”€â”€ Send email
â”‚   â”œâ”€â”€ Send Telegram
â”‚   â”œâ”€â”€ Send WhatsApp
â”‚   â””â”€â”€ Log notifications
â”‚
â”œâ”€â”€ Integrations
â”‚   â”œâ”€â”€ AQOP_Facebook_Leads
â”‚   â”œâ”€â”€ AQOP_WhatsApp_Integration
â”‚   â”œâ”€â”€ AQOP_Dropbox_Integration
â”‚   â””â”€â”€ AQOP_Airtable_Sync
â”‚
â””â”€â”€ CLI Tools
    â”œâ”€â”€ cli-test-sync.php
    â””â”€â”€ cli-update-mappings.php
```

---

## Part 3: Data Flow Diagrams

### Data Flow 1: New Lead Creation (Public Form)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Web Visitor   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ 1. Fill form [aqop_lead_form]
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Client-Side    â”‚
â”‚  JavaScript     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ 2. AJAX: aqop_submit_lead_form
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  wp-admin/admin-ajax.php               â”‚
â”‚  (AQOP_Public_Form::handle_...)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ 3. Check rate limit (IP-based)
         â–¼
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚  Rate Limit OK?  â”‚ â”€â”€NOâ”€â”€â–¶ Return Error (429)
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚ YES
               â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Verify nonce &     â”‚
    â”‚  Sanitize inputs    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AQOP_Leads_Manager            â”‚
â”‚  ::create_lead()               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ 4. Insert into wp_aq_leads
         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  MySQL Database  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â”œâ”€â–º 5. Log event to wp_aq_events_log
             â”‚
             â”œâ”€â–º 6. Sync to Airtable (if configured)
             â”‚
             â”œâ”€â–º 7. Send email notification
             â”‚
             â””â”€â–º 8. Send Telegram notification
                   (if bot configured)
             â”‚
             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Return Success â”‚
    â”‚  Response JSON  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Client displays    â”‚
â”‚  success message    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Data Flow 2: Lead Update (Admin)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Admin User      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ 1. Click Edit on lead
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Load lead-detail.php            â”‚
â”‚  (AQOP_Lead_Details_Handler)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ 2. Query lead from database
         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  MySQL Database  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Display form with data  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ 3. Admin edits and submits
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AQOP_Leads_Admin                  â”‚
â”‚  ::handle_form_submission()        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ 4. Check nonce & capabilities
         â–¼
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚  Authorized?     â”‚ â”€â”€NOâ”€â”€â–¶ Return Error
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚ YES
               â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Sanitize & validate    â”‚
    â”‚  input data             â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AQOP_Leads_Manager          â”‚
â”‚  ::update_lead()             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ 5. UPDATE wp_aq_leads
         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  MySQL Database  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â”œâ”€â–º 6. Log event (lead_updated)
             â”‚
             â”œâ”€â–º 7. Sync to Airtable
             â”‚
             â”œâ”€â–º 8. Clear cache (wp_cache_delete)
             â”‚
             â””â”€â–º 9. Trigger action hook
                   (aqop_lead_updated)
             â”‚
             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Return success &   â”‚
    â”‚  redirect to leads  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Data Flow 3: REST API Request

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  External Client â”‚
â”‚  (React App)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ 1. GET /wp-json/aqop/v1/leads
         â”‚    Header: Authorization: Bearer TOKEN
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  WordPress REST API Router         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ 2. Parse request & match route
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AQOP_Leads_API                  â”‚
â”‚  ::permission_callback()         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ 3. Verify JWT token
         â–¼
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚  Token valid?    â”‚ â”€â”€NOâ”€â”€â–¶ Return 401
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚ YES
               â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Check user role &     â”‚
    â”‚  capabilities          â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚  Authorized?     â”‚ â”€â”€NOâ”€â”€â–¶ Return 403
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚ YES
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AQOP_Leads_API::get_leads()     â”‚
â”‚  (or other method)               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ 4. Build role-filtered query
         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  MySQL Database  â”‚
    â”‚  (Only visible   â”‚
    â”‚   leads for role)â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Format response   â”‚
â”‚  as JSON           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Return JSON    â”‚
    â”‚  with 200 OK    â”‚
    â”‚  + Headers      â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Client receives   â”‚
â”‚  & processes data  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Part 4: Database Schema

### Entity Relationship Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    CORE TABLES                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚  wp_aq_events_log                      â”‚            â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤            â”‚
â”‚  â”‚ id (PK)                                â”‚            â”‚
â”‚  â”‚ module_id (FK) â”€â”€â”                     â”‚            â”‚
â”‚  â”‚ event_type_id(FK)â”¼â”€â”€â”                  â”‚            â”‚
â”‚  â”‚ object_type      â”‚  â”‚                  â”‚            â”‚
â”‚  â”‚ object_id        â”‚  â”‚                  â”‚            â”‚
â”‚  â”‚ user_id          â”‚  â”‚                  â”‚            â”‚
â”‚  â”‚ metadata (JSON)  â”‚  â”‚                  â”‚            â”‚
â”‚  â”‚ created_at       â”‚  â”‚                  â”‚            â”‚
â”‚  â”‚ ip_address       â”‚  â”‚                  â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                      â”‚  â”‚                                â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                                â”‚
â”‚         â”‚               â”‚                                â”‚
â”‚         â–¼               â–¼                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚wp_aq_dim_    â”‚  â”‚wp_aq_dim_event_  â”‚                â”‚
â”‚  â”‚modules       â”‚  â”‚types             â”‚                â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                â”‚
â”‚  â”‚ id (PK)      â”‚  â”‚ id (PK)          â”‚                â”‚
â”‚  â”‚ name         â”‚  â”‚ name             â”‚                â”‚
â”‚  â”‚ code         â”‚  â”‚ code             â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    LEADS TABLES                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚  wp_aq_leads (MAIN FACT TABLE)         â”‚            â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤            â”‚
â”‚  â”‚ id (PK)                                â”‚            â”‚
â”‚  â”‚ name                                   â”‚            â”‚
â”‚  â”‚ email (UNIQUE)                         â”‚            â”‚
â”‚  â”‚ phone                                  â”‚            â”‚
â”‚  â”‚ whatsapp                               â”‚            â”‚
â”‚  â”‚ country_id (FK)â”€â”€â”€â”€â”€â”€â”€â”                â”‚            â”‚
â”‚  â”‚ source_id (FK)â”€â”€â”€â”€â”   â”‚                â”‚            â”‚
â”‚  â”‚ status_id (FK)â”€â”€â” â”‚   â”‚                â”‚            â”‚
â”‚  â”‚ campaign_id (FK)â”€â”¼â”€â”¼â”€â”â”‚                â”‚            â”‚
â”‚  â”‚ priority (ENUM) â”‚ â”‚ â”‚â”‚                â”‚            â”‚
â”‚  â”‚ assigned_to     â”‚ â”‚ â”‚â”‚                â”‚            â”‚
â”‚  â”‚ custom_fields   â”‚ â”‚ â”‚â”‚                â”‚            â”‚
â”‚  â”‚ airtable_record_id                    â”‚            â”‚
â”‚  â”‚ created_at      â”‚ â”‚ â”‚â”‚                â”‚            â”‚
â”‚  â”‚ updated_at      â”‚ â”‚ â”‚â”‚                â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚           â”‚     â”‚ â”‚ â”‚â”‚                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”  â”‚ â”‚â”‚ â”‚â”‚                                  â”‚
â”‚  â”‚ NOTES    â”‚  â”‚ â”‚â”‚ â”‚â”‚                                  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚ â”‚â”‚ â”‚â”‚                                  â”‚
â”‚  â”‚wp_aq_    â”‚  â”‚ â”‚â”‚ â”‚â”‚                                  â”‚
â”‚  â”‚leads_    â”‚  â”‚ â”‚â”‚ â”‚â”‚                                  â”‚
â”‚  â”‚notes     â”‚  â”‚ â”‚â”‚ â”‚â”‚                                  â”‚
â”‚  â”‚ id (PK)  â”‚  â”‚ â”‚â”‚ â”‚â”‚                                  â”‚
â”‚  â”‚ lead_id  â”‚â”€â”€â”˜ â”‚â”‚ â”‚â”‚                                  â”‚
â”‚  â”‚ (FK)     â”‚    â”‚â”‚ â”‚â”‚                                  â”‚
â”‚  â”‚ content  â”‚    â”‚â”‚ â”‚â”‚                                  â”‚
â”‚  â”‚ user_id  â”‚    â”‚â”‚ â”‚â”‚                                  â”‚
â”‚  â”‚ created_ â”‚    â”‚â”‚ â”‚â”‚                                  â”‚
â”‚  â”‚ at       â”‚    â”‚â”‚ â”‚â”‚                                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚â”‚ â”‚â”‚                                  â”‚
â”‚                  â”‚â”‚ â”‚â”‚                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”˜â”‚ â”‚â”‚                                  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”˜â”‚                                  â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚  â”‚  â”‚                                 â”‚              â”‚
â”‚  â–¼  â–¼  â–¼                                 â–¼              â”‚
â”‚  STATUS  SOURCES              CAMPAIGNS â”‚              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤              â”‚
â”‚  â”‚id    â”‚  â”‚id     â”‚         â”‚id        â”‚              â”‚
â”‚  â”‚name  â”‚  â”‚name   â”‚         â”‚name      â”‚              â”‚
â”‚  â”‚color â”‚  â”‚icon   â”‚         â”‚descript- â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚ion       â”‚              â”‚
â”‚                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  DIMENSION TABLES                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  wp_aq_dim_countries    wp_aq_dim_date                 â”‚
â”‚  â”œâ”€ id                  â”œâ”€ id                          â”‚
â”‚  â”œâ”€ name                â”œâ”€ date                        â”‚
â”‚  â”œâ”€ code                â”œâ”€ year                        â”‚
â”‚  â””â”€ flag                â”œâ”€ month                       â”‚
â”‚                         â””â”€ quarter                     â”‚
â”‚                                                         â”‚
â”‚  wp_aq_dim_time         wp_aq_dim_users                â”‚
â”‚  â”œâ”€ id                  â”œâ”€ id                          â”‚
â”‚  â”œâ”€ hour                â”œâ”€ user_id (WP user)           â”‚
â”‚  â”œâ”€ minute              â”œâ”€ role                        â”‚
â”‚  â””â”€ period              â””â”€ permissions                 â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Database Query Optimization

```
Performance Optimizations Implemented:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

1. INDEXES:
   â”œâ”€ wp_aq_leads (email)        â†’ Fast email lookup
   â”œâ”€ wp_aq_leads (status_id)    â†’ Filter by status
   â”œâ”€ wp_aq_leads (created_at)   â†’ Date range queries
   â”œâ”€ wp_aq_leads (country_id)   â†’ Country filter
   â””â”€ wp_aq_leads_notes (lead_id) â†’ Load notes

2. RELATIONSHIPS:
   â”œâ”€ Foreign keys define relationships
   â”œâ”€ Cascading deletes prevent orphans
   â””â”€ Referential integrity enforced

3. PARTITIONING (Future):
   â”œâ”€ By date (monthly)
   â”œâ”€ By region/country
   â””â”€ By lead status

4. CACHING:
   â”œâ”€ wp_cache_get/set for frequently used data
   â”œâ”€ 1-hour cache on dimension tables
   â”œâ”€ 10-minute cache on lead queries
   â””â”€ Real-time cache invalidation on updates
```

---

## Part 5: Authentication & Authorization Flow

### JWT Token Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User Login     â”‚
â”‚  (Username/PW)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  JWT Handler                     â”‚
â”‚  (class-jwt-handler.php)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ 1. Verify WordPress credentials
         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  WordPress Check    â”‚
    â”‚  wp_authenticate()  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â”œâ”€ Check role permissions
             â”œâ”€ Verify user active
             â””â”€ Check capabilities
             â”‚
             â–¼
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚  Valid?          â”‚ â”€â”€NOâ”€â”€â–¶ Return 401
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚ YES
               â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  2. Generate JWT            â”‚
    â”‚                             â”‚
    â”‚  Header:                    â”‚
    â”‚  {                          â”‚
    â”‚    "alg": "HS256",          â”‚
    â”‚    "typ": "JWT"             â”‚
    â”‚  }                          â”‚
    â”‚                             â”‚
    â”‚  Payload:                   â”‚
    â”‚  {                          â”‚
    â”‚    "user_id": 1,            â”‚
    â”‚    "role": "admin",         â”‚
    â”‚    "iat": 1234567890,       â”‚
    â”‚    "exp": 1234568790        â”‚
    â”‚  }                          â”‚
    â”‚                             â”‚
    â”‚  Signature:                 â”‚
    â”‚  HS256(                     â”‚
    â”‚    header.payload,          â”‚
    â”‚    secret_key_256_bits      â”‚
    â”‚  )                          â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  3. Generate Refresh Token       â”‚
    â”‚     (7 days expiry)              â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  4. Return Tokens            â”‚
    â”‚                              â”‚
    â”‚  {                           â”‚
    â”‚    "access_token": "...",    â”‚
    â”‚    "refresh_token": "...",   â”‚
    â”‚    "expires_in": 900,        â”‚
    â”‚    "token_type": "Bearer"    â”‚
    â”‚  }                           â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Store in localStorage   â”‚
    â”‚  (Client-side)           â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Request Authorization Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Client makes API call  â”‚
â”‚  Header: Authorization: â”‚
â”‚  Bearer ACCESS_TOKEN    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Middleware Check                  â”‚
â”‚  (wp-json/rest_api_init)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ 1. Extract token from header
         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Token exists?     â”‚ â”€â”€NOâ”€â”€â–¶ Return 401
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚ YES
             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  2. Verify JWT         â”‚
    â”‚                        â”‚
    â”‚  â”œâ”€ Check signature    â”‚
    â”‚  â”œâ”€ Check not expired  â”‚
    â”‚  â”œâ”€ Check user exists  â”‚
    â”‚  â””â”€ Check not blacklistâ”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â”œâ”€ Invalid? â”€â”€â–¶ Return 401
             â”‚
             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  3. Extract user data  â”‚
    â”‚  from payload          â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  4. Check permission   â”‚
    â”‚  callback              â”‚
    â”‚                        â”‚
    â”‚  â”œâ”€ Check capability   â”‚
    â”‚  â”œâ”€ Check resource own.â”‚
    â”‚  â””â”€ Check role level   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â”œâ”€ No permission? â”€â”€â–¶ Return 403
             â”‚
             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  5. Build filtered     â”‚
    â”‚  query (by role)       â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  6. Execute & return   â”‚
    â”‚  authorized data only  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Part 6: Feature Implementation Matrix

### Core Features Implementation

```
FEATURE                    BACKEND    FRONTEND    API    NOTES
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Lead CRUD                  âœ… 100%    â³ 70%     âœ…    Database ready
Advanced Filtering         âœ… 100%    â³ 70%     âœ…    6 filter types
Bulk Operations            âœ… 100%    â³ 70%     â³    Backend complete
Analytics Dashboard        âœ… 100%    â³ 70%     â³    4 KPIs, 3 charts
CSV Import/Export          âœ… 100%    â³ 70%     â³    With validation
Public Form                âœ… 100%    â³ 70%     â³    Rate-limited
REST API                   âœ… 100%    âœ… 100%   âœ…    8 endpoints
Airtable Sync              âœ… 100%    â³ 0%      â³    Bi-directional
Telegram Notifications     âœ… 100%    â³ 0%      â³    Working
Email Notifications        âœ… 100%    â³ 0%      â³    Working
Event Logging              âœ… 100%    â³ 70%     âœ…    Complete trail
Notes Management           âœ… 100%    â³ 70%     â³    AJAX enabled
Lead Assignment            âœ… 100%    â³ 70%     âœ…    Role-aware
Custom Fields              âœ… 100%    â³ 70%     â³    JSON-based
Role-Based Access          âœ… 100%    âœ… 100%   âœ…    4 roles
Activity Feed              âœ… 100%    â³ 70%     âœ…    Real-time
Lead Scoring               âœ… 100%    â³ 0%      â³    Calculated

Legend:
âœ… = Complete (100%)
â³ = In Progress (%)
âŒ = Not Started (0%)
```

---

## Part 7: Integration Points Map

### External Integrations

```
AQOP PLATFORM
â”‚
â”œâ”€â–º Airtable
â”‚   â”œâ”€â”€ Sync leads on create
â”‚   â”œâ”€â”€ Sync leads on update
â”‚   â”œâ”€â”€ Sync on status change
â”‚   â”œâ”€â”€ Store record ID
â”‚   â””â”€â”€ Sync on assignment
â”‚
â”œâ”€â–º Telegram
â”‚   â”œâ”€â”€ Send new lead alerts
â”‚   â”œâ”€â”€ Send status change alerts
â”‚   â”œâ”€â”€ Daily summary
â”‚   â””â”€â”€ Error notifications
â”‚
â”œâ”€â–º Facebook Lead Ads
â”‚   â”œâ”€â”€ Auto-import leads
â”‚   â”œâ”€â”€ Webhook listener
â”‚   â”œâ”€â”€ Map fields
â”‚   â””â”€â”€ Track campaign
â”‚
â”œâ”€â–º WhatsApp Business
â”‚   â”œâ”€â”€ Send messages
â”‚   â”œâ”€â”€ Bulk messaging
â”‚   â”œâ”€â”€ Message templates
â”‚   â””â”€â”€ Delivery tracking
â”‚
â”œâ”€â–º Dropbox
â”‚   â”œâ”€â”€ Store attachments
â”‚   â”œâ”€â”€ Organize by lead
â”‚   â”œâ”€â”€ Share files
â”‚   â””â”€â”€ Backup data
â”‚
â””â”€â–º WordPress
    â”œâ”€â”€ User system
    â”œâ”€â”€ Capabilities
    â”œâ”€â”€ Email system
    â””â”€â”€ Cache system
```

---

## Part 8: Deployment Architecture

### Production Environment

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               PRODUCTION SERVER                         â”‚
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Nginx / Apache (Web Server)                      â”‚  â”‚
â”‚  â”‚  â”œâ”€ Reverse proxy                                 â”‚  â”‚
â”‚  â”‚  â”œâ”€ SSL/TLS termination                           â”‚  â”‚
â”‚  â”‚  â”œâ”€ Compression                                   â”‚  â”‚
â”‚  â”‚  â””â”€ Rate limiting                                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                  â”‚                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  PHP-FPM (Application Layer)                      â”‚  â”‚
â”‚  â”‚  â”œâ”€ WordPress 6.0+                               â”‚  â”‚
â”‚  â”‚  â”œâ”€ PHP 8.1+                                      â”‚  â”‚
â”‚  â”‚  â”œâ”€ AQOP Plugins                                 â”‚  â”‚
â”‚  â”‚  â””â”€ Sessions/Caching                             â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                  â”‚                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  MySQL Database Layer                             â”‚  â”‚
â”‚  â”‚  â”œâ”€ InnoDB storage engine                         â”‚  â”‚
â”‚  â”‚  â”œâ”€ Optimized indexes                             â”‚  â”‚
â”‚  â”‚  â”œâ”€ AQOP tables (30+)                             â”‚  â”‚
â”‚  â”‚  â””â”€ Automated backups                             â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Caching Layer (Optional)                         â”‚  â”‚
â”‚  â”‚  â”œâ”€ Redis / Memcached                             â”‚  â”‚
â”‚  â”‚  â”œâ”€ Database query cache                          â”‚  â”‚
â”‚  â”‚  â”œâ”€ API response cache                            â”‚  â”‚
â”‚  â”‚  â””â”€ Transient cache                               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Background Jobs (CRON)                           â”‚  â”‚
â”‚  â”‚  â”œâ”€ Hourly: Check Airtable sync                   â”‚  â”‚
â”‚  â”‚  â”œâ”€ Daily: Clean expired tokens                   â”‚  â”‚
â”‚  â”‚  â”œâ”€ Daily: Generate reports                       â”‚  â”‚
â”‚  â”‚  â””â”€ Weekly: Cleanup old logs                      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Summary

This technical architecture map provides:

1. **System Overview:** High-level architecture of AQOP
2. **Component Structure:** Detailed breakdown of each layer
3. **Data Flows:** Step-by-step processes for main operations
4. **Database Schema:** Entity relationships and optimization
5. **Security Flows:** Authentication and authorization
6. **Implementation Status:** Feature completion matrix
7. **Integration Points:** External service connections
8. **Deployment Architecture:** Production environment setup

This map should serve as a reference for:
- New developers joining the project
- System architects reviewing the platform
- DevOps engineers deploying the system
- QA teams testing the system
- Future maintenance and upgrades

---

**Document Version:** 1.0.10  
**Last Updated:** February 7, 2026  
**Next Review:** Upon major feature addition
